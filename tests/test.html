<!DOCTYPE "html">
<html>
  <head>
    <meta charset="utf-8" />
    <script type="module">
      import { JavaScriptBackend } from "../../SymatemJS/SymatemJS.mjs";
      import { CompilerContext } from "../main.js";
      import { Program } from "../program.js";

      //const tests = ['Conversions','FastInverseSquareRoot','FibRec','GcdRec','Memory'];

      const context = new CompilerContext(new JavaScriptBackend()),
        program = new Program(context.backend);

      const button = document.getElementById("button");
      button.onclick = async () => {
        button.parentNode.removeChild(button);

        try {
          const response = await fetch(
            "src/JS/" + document.body.children[0].innerText
          );

          const codeBox = document.body.children[0],
            time0 = performance.now(),
            inputs = eval("(" + (await response.text()) + ")")(program),
            time1 = performance.now();
          try {
            const entry = context.execute(inputs, true),
              time2 = performance.now();
            console.log(time1 - time0, time2 - time1);
            codeBox.innerText = context.getLlvmCode();
          } catch (error) {
            codeBox.innerText = context.logMessages.join("\n");
            console.log(error);
          }
        } catch {
          document.body.children[0].innerText = "Could not fetch";
        }
      };
    </script>
  </head>
  <body>
    <pre contenteditable="true">FastInverseSquareRoot.js</pre>
    <input id="button" type="button" value="Fetch & Compile" />
  </body>
</html>
